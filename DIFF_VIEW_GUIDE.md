# 文本对比编辑器使用指南

## 功能简介

文本对比编辑器是一个类似 Cursor 的内联 diff 功能，用于对比两个文本的差异，并允许用户在原文中逐个查看和决定接受或拒绝每个更改。

## 访问方式

1. **从首页进入**：在首页点击 "文本对比 🆕" 卡片
2. **直接访问**：浏览器访问 `/diff` 路由

## 界面布局

### 主视图（左侧）
- **内联差异显示**：在统一的视图中显示所有文本
- **上下文保留**：未更改的文本正常显示，提供完整上下文
- **高亮变更块**：每个变更块都有明显的视觉区分

### 侧边栏（右侧）
1. **原始文本编辑器**：可以编辑或锁定原始文本
2. **新文本编辑器**：可以编辑或锁定新文本
3. **最终结果预览**：实时显示应用更改后的结果

## 核心功能

### 1. 内联差异显示

每个变更块都在原文位置显示，包含：

#### 删除内容（红色背景）
- 🔴 标记为"删除"
- 显示被删除的原始文本
- 左侧有红色边框标识

#### 新增内容（绿色背景）
- 🟢 标记为"新增"
- 显示新增的文本内容
- 左侧有绿色边框标识

#### 修改内容
- 同时显示删除和新增两部分
- 上方是删除的旧内容
- 下方是新增的内容

### 2. 逐块操作

每个变更块底部都有操作按钮：

**接受更改**
- 点击 ✓ "接受更改" 按钮
- 变更块变为绿色边框，表示已接受
- 该更改会应用到最终结果中

**拒绝更改**
- 点击 ✗ "拒绝更改" 按钮
- 变更块变灰，表示已拒绝
- 该更改不会应用到最终结果中

### 3. 批量操作

顶部工具栏提供：
- **接受全部**：一键接受所有未处理的更改
- **拒绝全部**：一键拒绝所有未处理的更改
- **重置示例**：恢复到默认示例文本
- **复制结果**：快速复制最终结果到剪贴板

### 4. 实时编辑

侧边栏允许你编辑原始文本和新文本：
- 🔓 解锁图标：当前可编辑
- 🔒 锁定图标：当前只读
- 点击切换编辑/锁定状态
- 任何编辑都会立即重新计算差异

### 5. 统计信息

顶部状态栏实时显示：
- **变更块**：总共有多少个变更
- **待接受**：还有多少个未处理的变更
- **待拒绝**：同上
- **已接受**：已经接受了多少个变更

## 视觉状态

### 待处理（蓝色边框）
- 默认状态，等待你的决定
- 蓝色边框突出显示

### 已接受（绿色边框）
- 接受后变为绿色
- 按钮显示"已接受"
- 该更改会反映在最终结果中

### 已拒绝（灰色边框）
- 拒绝后变灰、半透明
- 按钮显示"已拒绝"
- 该更改不会应用

## 使用场景

### 1. 代码审查
```
场景：审查同事的代码修改
操作：逐个查看每个变更，接受好的修改，拒绝不合适的
```

### 2. 文档修订
```
场景：对比文档的原稿和修订版
操作：在保留上下文的情况下，选择性地接受修订建议
```

### 3. AI 建议审核
```
场景：AI 对你的代码提出了改进建议
操作：在原文中直接看到所有建议，决定采纳哪些
```

### 4. 版本对比
```
场景：对比同一文件的两个版本
操作：清晰地看到每一处差异，选择保留哪些更改
```

## 示例场景说明

默认加载了一个函数优化的示例，展示了多种类型的更改：

### 1. 参数添加
```javascript
// 删除：function calculateTotal(items) {
// 新增：function calculateTotal(items, discount = 0) {
```
在第一个变更块中，你可以看到函数签名的变化，决定是否接受添加折扣参数。

### 2. 代码现代化
```javascript
// 删除：for (let i = 0; i < items.length; i++) {
// 新增：for (const item of items) {
```
将传统循环改为现代的 for...of 循环。

### 3. 逻辑增强
```javascript
// 删除：total += items[i].price;
// 新增：total += item.price * item.quantity;
```
添加数量计算。

### 4. 注释添加
纯新增的注释块，没有删除内容。

### 5. 对象属性添加
在 user 对象中添加 email 属性。

### 6. 文本修改
将 console.log 的输出从英文改为中文。

## 快捷技巧

### 💡 最佳实践
1. **从上往下审查**：按照文档顺序逐个处理变更
2. **关注上下文**：利用周围的未变更文本理解变更的意图
3. **实时查看结果**：随时在侧边栏查看应用更改后的最终结果
4. **灵活调整**：可以随时更改决定（再次点击按钮切换状态）

### ⌨️ 工作流程
1. 在侧边栏编辑原始文本和新文本
2. 在主视图中逐个查看变更块
3. 点击"接受更改"或"拒绝更改"
4. 在侧边栏的"最终结果"中实时查看效果
5. 满意后点击"复制结果"获取最终文本

### 🎨 视觉提示
- **红色**：删除的内容
- **绿色**：新增的内容
- **蓝色**：待处理的变更
- **灰色**：已拒绝的变更

## 与 Cursor 的对比

本工具实现了与 Cursor 类似的核心体验：

✅ **相同点**
- 内联显示差异，保持上下文
- 逐块接受/拒绝更改
- 清晰的视觉区分
- 实时结果预览

➕ **增强功能**
- 侧边栏可以直接编辑原始和新文本
- 统计信息一目了然
- 批量操作更便捷
- Web 端使用，无需安装

## 技术特点

- 🎯 **智能算法**：使用 diff-match-patch 进行语义化差异检测
- 🚀 **实时响应**：修改文本立即重新计算差异
- 🎨 **现代 UI**：深色主题，类似 VS Code/Cursor 的专业界面
- 📱 **响应式**：适配不同屏幕尺寸
- ⚡ **轻量级**：纯前端实现，无需后端支持

## 浏览器支持

- Chrome/Edge 90+
- Firefox 88+
- Safari 14+

## 常见问题

**Q: 如何撤销我的决定？**  
A: 只需再次点击对应的按钮即可切换状态。

**Q: 接受和拒绝有什么区别？**  
A: 接受会将更改应用到最终结果；拒绝会保留原文不变。

**Q: 可以同时编辑原文和新文本吗？**  
A: 可以！点击🔓/🔒图标解锁编辑器，修改后会自动重新计算差异。

**Q: 最终结果在哪里？**  
A: 在右侧侧边栏的底部"最终结果"区域，实时显示应用所有已接受更改后的文本。

---

**提示**：这个工具特别适合需要精细控制文本修改的场景，让你能够在完整的上下文中查看每一处变化并做出决策，就像在 Cursor 中审查 AI 建议一样！

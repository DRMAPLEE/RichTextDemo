# 应用更改工作流说明

## 功能概述

当所有变更块都处理完成（全部接受或拒绝）后，系统会自动检测并提供"应用更改"功能，将最终结果作为新的基准，开始新一轮对比。

## 工作流程

### 1. 初始状态 - 对比阶段
```
用户输入原始文本和新文本
    ↓
系统生成差异对比
    ↓
显示所有变更块
```

### 2. 处理阶段 - 逐个决策
```
对每个变更块：
  - 接受 ✓ → 应用到最终结果
  - 拒绝 ✗ → 保留原文
```

### 3. 完成检测 - 自动触发
```
当所有变更块都已处理：
  ✓ 统计栏变绿，显示完成徽章
  ✓ 工具栏出现"应用更改"按钮（脉冲动画）
  ✓ 主视图显示完成卡片
```

### 4. 应用更改 - 开始新一轮
```
点击"应用更改"按钮：
  1. 将最终结果设为新的原始文本
  2. 新文本也设为相同内容
  3. 清空所有变更块
  4. 界面恢复到初始状态
  
→ 现在可以编辑新文本，开始新一轮对比
```

## 用户界面变化

### 统计栏
```
正常状态：
┌──────────────────────────────────────────┐
│ 变更块: 6 | 待处理: 4 | 已接受: 2 | 已拒绝: 0 │
└──────────────────────────────────────────┘

完成状态：
┌──────────────────────────────────────────────────────────┐
│ 变更块: 6 | 待处理: 0 | 已接受: 4 | 已拒绝: 2 │ ✓ 全部完成！│
└──────────────────────────────────────────────────────────┘
       ↑ 背景变绿，边框高亮
```

### 工具栏
```
正常状态：
[接受全部] [拒绝全部] [重置示例] [复制结果]

完成状态：
[✨ 应用更改] [接受全部] [拒绝全部] [重置示例] [复制结果]
    ↑ 新按钮出现，带脉冲动画
```

### 主视图完成卡片
```
╔════════════════════════════════════════════╗
║           🎉 所有变更已处理完成！            ║
║                                            ║
║     你已经处理了全部 6 个变更块。            ║
║     点击下方按钮应用最终结果并开始新一轮对比。  ║
║                                            ║
║     ┌─────────┐  ┌─────────┐              ║
║     │   4     │  │   2     │              ║
║     │ 已接受   │  │ 已拒绝   │              ║
║     └─────────┘  └─────────┘              ║
║                                            ║
║     [✓ 应用更改并开始新一轮对比]             ║
║                                            ║
║     💡 提示：应用后，最终结果将成为新的       ║
║        原始文本，你可以继续编辑和对比。       ║
╚════════════════════════════════════════════╝
```

## 视觉效果

### 动画效果
1. **脉冲动画**：应用更改按钮持续脉冲，吸引注意
2. **滑入动画**：完成徽章从右侧滑入
3. **渐变动画**：完成卡片淡入并从上方滑下
4. **缩放动画**：完成图标从小到大弹出

### 颜色变化
- **统计栏**：从灰色变为渐变绿色
- **边框**：从灰色变为青绿色（#4ec9b0）
- **按钮**：应用更改按钮为绿色渐变 + 发光效果

## 使用场景

### 场景 1：多轮代码审查
```
第一轮：
1. 粘贴原始代码和修改后的代码
2. 逐个审查 10 个变更
3. 接受 7 个，拒绝 3 个
4. 点击"应用更改"

第二轮：
1. 在第一轮结果基础上继续修改
2. 再次审查新的变更
3. 持续优化代码
```

### 场景 2：迭代式文档编辑
```
初稿 → 第一次修订 → 应用更改
    → 第二次修订 → 应用更改
    → 第三次修订 → 应用更改
    → 最终定稿
```

### 场景 3：AI 建议的多次应用
```
原始代码
    ↓
AI 建议第一批改进 → 选择性接受 → 应用
    ↓
AI 建议第二批改进 → 选择性接受 → 应用
    ↓
AI 建议第三批改进 → 选择性接受 → 应用
    ↓
最终优化版本
```

## 技术实现

### 状态检测
```javascript
const allProcessed = computed(() => {
  if (diffBlocks.value.length === 0) return false
  return diffBlocks.value.every((b) => b.accepted || b.rejected)
})
```

### 应用逻辑
```javascript
const applyChangesAndContinue = () => {
  // 1. 获取最终结果
  const result = finalResult.value
  
  // 2. 设为新的基准
  originalText.value = result
  newText.value = result
  
  // 3. 清空变更
  diffBlocks.value = []
  
  // 4. 滚动到顶部
  scrollToTop()
}
```

### 条件渲染
```vue
<!-- 工具栏按钮 -->
<button v-if="allProcessed && hasChanges">
  应用更改
</button>

<!-- 完成卡片 -->
<div v-if="allProcessed && hasChanges">
  完成提示
</div>

<!-- 统计栏徽章 -->
<div v-if="allProcessed && hasChanges">
  全部完成！
</div>
```

## 快捷键（未来可扩展）

建议的快捷键：
- `Ctrl/Cmd + Enter` - 应用更改
- `Ctrl/Cmd + Shift + A` - 接受全部并应用
- `Ctrl/Cmd + Shift + R` - 拒绝全部并应用

## 最佳实践

### 建议工作流
1. **第一遍快速浏览**：了解所有变更
2. **第二遍仔细决策**：逐个接受/拒绝
3. **确认结果**：查看侧边栏的最终结果
4. **应用更改**：点击按钮开始新一轮

### 注意事项
- ⚠️ 应用更改后，之前的决策无法撤销
- ⚠️ 建议先查看最终结果，确认无误后再应用
- ⚠️ 可以使用"复制结果"按钮备份最终文本
- ✅ 重置示例按钮始终可用，可以随时重新开始

## 用户体验优化

### 即时反馈
- 统计栏实时更新待处理数量
- 到达 0 时立即显示完成状态
- 多处提示确保用户不会错过

### 视觉引导
- 脉冲动画吸引注意力
- 绿色主题表示成功完成
- 大卡片提供清晰的下一步指引

### 流畅过渡
- 平滑的动画效果
- 自动滚动到顶部
- 状态变化有视觉反馈

## 与其他功能的集成

### 复制结果
- 应用更改前可以复制结果备份
- 应用后仍可以继续复制

### 重置示例
- 可以随时放弃当前工作
- 恢复到默认示例状态

### 接受/拒绝全部
- 快速完成所有决策
- 立即触发完成状态

---

**总结**：这个工作流设计让用户可以进行多轮迭代式的文本对比和修改，每次应用更改后都可以在上一次的结果基础上继续优化，形成一个持续改进的循环。

